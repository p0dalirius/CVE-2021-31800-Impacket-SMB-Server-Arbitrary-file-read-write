FROM debian:latest

ENV COMMIT cb6d43a677c338db930bc4e9161620832c1ec624

RUN apt-get -y -q update; \
    apt-get -y -q install xxd git unzip wget nano python3 python3-pip build-essential libffi-dev openssl rustc libssl-dev

RUN mkdir -p /opt/tools/ \
    && cd /opt/tools/ \
    && git clone https://github.com/fortra/impacket/ \
    && cd impacket \
    && git reset --hard ${COMMIT}

COPY ./patched/ /opt/tools/impacket/impacket/examples/

RUN cd /opt/tools/impacket/ \
    && python3 -m pip install -r requirements.txt \
    && python3 -m pip install .

RUN echo 'smbclient.py 192.168.1.17' > /root/.bash_history
WORKDIR /opt/tools/impacket/examples/

CMD /bin/bash
